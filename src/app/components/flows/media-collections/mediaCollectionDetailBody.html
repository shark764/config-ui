<div class="divider-header first-header">
  <h4>Details</h4>
</div>
<div class="input-group">
  <label>{{'value.name' | translate}} *</label>
  <div>
    <form-error field="detailsForm.collectionName" error-type-api="true"
      error-type-required="{{'media.details.name.error' | translate}}"></form-error>
    <input type="text" ng-required="true" ng-model="resource.name" name="collectionName"></input>
  </div>
</div>
<div class="input-group">
  <label class="textarea-label">{{'value.description' | translate}}</label>
  <div>
    <form-error field="detailsForm.description" error-type-api="{{'media.details.description.error' | translate}}"></form-error>
    <textarea ng-model="resource.description" name="description"></textarea>
  </div>
</div>
<div ng-if="resource.mediaMap != undefined && resource.mediaMap.length > 0" class="input-group">
  <label>{{'media.collections.defaultMediaKey' | translate}} *</label>
  <div>
    <form-error field="detailsForm.defaultMediaKey" error-type-api="true"
      error-type-required="{{'media.collections.defaultMediaKey.error' | translate}}"></form-error>
    <select ng-class="{'default-selected': ! resource.defaultMediaKey}" ng-required="true"
      name="defaultMediaKey" ng-model="resource.defaultMediaKey"
      ng-options="mapping.lookup as mapping.lookup for mapping in resource.mediaMap">
      <option value="" ng-disabled="true">{{'media.collections.defaultMediaKey.select' | translate}}</option>
    </select>
  </div>
</div>

<div class="divider-header ">
  <h4>Media Mappings</h4>
</div>

<form-error field="detailsForm.mediaMapChanges" error-type-api="true"></form-error>
<input type="text" name="mediaMapChanges" ng-model="mediaMapChanges" ng-hide="true"/>

<div class="clear">
  <a id="add-media-mapping-button" class="btn pull-right" ng-click="addMapping(resource, detailsForm)"><i class="fa fa-plus"></i></a>
</div>

<table class="media-collection-table table" >
  <thead>
    <th>{{'value.identifier' | translate}}</th>
    <th>{{'value.media' | translate}}</th>
    <th>&nbsp;</th>
  </thead>
  <tbody>
    <tr ng-show="! resource.mediaMap.length"><td colspan="3"><p class="null">{{'media.collections.mapping.add' | translate}}</p></td></tr>
    <tr ng-repeat="mapping in resource.mediaMap">
      <td>
        <form-error ng-init="mappingFieldName='mapping' + $index" field="detailsForm[mappingFieldName]"
          error-type-required="{{'media.collections.mappingLookup.error' | translate}}"></form-error>
        <input 
          ng-change="'{{mapping.lookup}}' == resource.defaultMediaKey ? resetDefaultMediaKey(resource, detailsForm) : ''" 
          ng-required="true" 
          type="text" 
          name="{{mappingFieldName}}" 
          ng-model="mapping.lookup" />
      </td>
      <td>
        <form-error ng-init="fieldName='source' + $index" ng-show="! editMode" field="detailsForm[fieldName]"
          error-type-required="{{'media.collections.mappingId.error' | translate}}"></form-error>
        <div class="modify-media-box" ng-class="{'edit': editMode === true}">
          <div class="label-container" ng-click="editMode = !editMode;">
            <input type="text" placeholder="{{'media.collections.media.add' | translate}}" name="{{fieldName}}"
            class="label" ng-required="true" ng-model="mapping.name" readonly="true" border="0"/>
            <i class="fa" ng-class="{'fa-caret-down': !editMode, 'fa-caret-up':editMode}"></i>
          </div>

          <div class="media-edit-box" ng-show="editMode">
            <type-ahead
              object-type="mediaType"
              items="fetchMedias()"
              selected-item="selectedMedia"
              name-field="name"
              placeholder="{{'media.collections.mapping.search.placeholder' | translate}}"
              on-select="mapping.id = selectedMedia.id; mapping.name = selectedMedia.name; editMode = false; detailsForm[fieldName].$dirty = true; selectedMedia = null;"></type-ahead>
            <input ng-click="$emit('resource:details:create:mediaMapping', mapping); detailsForm.$dirty = true;"
              type="button" value="{{'media.collections.media.new' | translate}}" class="btn new-media-btn" />
          </div>
        </div>
      </td>
      <td class='remove-col'>
        <i id="remove-media-mapping-button" class="fa fa-times remove" ng-click="removeMapping(resource, detailsForm, $index)"></i>
      </td>
    </tr>
  </tbody>
</table>
